<!--pages/cards/cards.wxml-->
<view class="container">
  <!-- åŠ è½½ä¸­ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-icon"></view>
    <text>ğŸ¤– AI æ­£åœ¨æ‹¼å‘½ç”Ÿæˆä¸­...</text>
    <text class="loading-sub">Powered by DeepSeek</text>
  </view>

  <!-- å¡ç‰‡å±•ç¤ºåŒº -->
  <view class="card-container" wx:else>
    <!-- åªæœ‰å½“ cards æœ‰æ•°æ®æ—¶æ‰æ¸²æŸ“å†…å®¹ -->
    <block wx:if="{{cards.length > 0}}">
      <view class="progress">
        <text>ç¬¬ {{currentIndex + 1}}</text> / {{cards.length}} å¼ 
      </view>

      <view class="card-wrapper" bindtap="toggleFlip">
        <view class="card {{cards[currentIndex].isFlipped ? 'flipped' : ''}}">
          <!-- æ­£é¢ï¼šé—®é¢˜ -->
          <view class="card-face card-front">
            <view class="card-content">
              <view class="card-label">â“ Question</view>
              <view class="card-text">{{cards[currentIndex].question}}</view>
            </view>
            <view class="card-hint">ğŸ‘† ç‚¹å‡»ç¿»è½¬çœ‹ç­”æ¡ˆ</view>
          </view>

          <!-- èƒŒé¢ï¼šç­”æ¡ˆ -->
          <view class="card-face card-back">
            <view class="card-content">
              <view class="card-label answer-label">âœ… Answer</view>
              <view class="card-text answer-text">{{cards[currentIndex].answer}}</view>
              
              <view class="question-review">
                 <text class="review-label">å›é¡¾é—®é¢˜ï¼š</text>
                 <text>{{cards[currentIndex].question}}</text>
              </view>

              <view class="divider"></view>
              
              <view class="card-label tip-label">ğŸ’¡ Tips</view>
              <view class="card-tip">{{cards[currentIndex].tip}}</view>
              
              <view class="quote-container">
                <text class="quote-text">â€œ{{cards[currentIndex].quote}}â€</text>
              </view>
            </view>
          </view>
        </view>
      </view>
      
      <!-- å¼•æµå›¾ç‰‡å±•ç¤º -->
      <view class="promo-container">
        <!-- è¿™é‡Œçš„å›¾ç‰‡è·¯å¾„éœ€è¦ç”¨æˆ·å®é™…æ”¾å…¥æ–‡ä»¶ -->
        <image class="promo-image" src="/images/gzh.png" mode="widthFix" binderror="handleImageError"></image>
      </view>

      <!-- åº•éƒ¨æ“ä½œæ  -->
      <view class="action-bar">
        <view class="btn secondary" bindtap="prevCard" wx:if="{{currentIndex > 0}}">â¬…ï¸ ä¸Šä¸€å¼ </view>
        <view class="btn primary" bindtap="nextCard" wx:if="{{currentIndex < cards.length - 1}}">ä¸‹ä¸€å¼  â¡ï¸</view>
        <view class="btn success" bindtap="saveCardImage">ğŸ“¥ ä¿å­˜å¡ç‰‡</view>
        <view class="btn finish" bindtap="goHome" wx:if="{{currentIndex === cards.length - 1}}">ğŸ‰ å®Œæˆ</view>
      </view>
    </block>

    <!-- æ•°æ®ä¸ºç©ºæ—¶çš„å…œåº•å±•ç¤º -->
    <block wx:else>
      <view class="empty-state">
        <text>âš ï¸ ç”Ÿæˆå¤±è´¥ï¼Œæœªè·å–åˆ°å¡ç‰‡æ•°æ®</text>
        <view class="btn secondary" bindtap="goHome" style="margin-top: 40rpx;">è¿”å›é‡è¯•</view>
      </view>
    </block>
  </view>
  
  <!-- ç”¨äºç”Ÿæˆå›¾ç‰‡çš„ Canvas (å°ºå¯¸è°ƒå¤§ä»¥å®¹çº³åº•éƒ¨å›¾ç‰‡) -->
  <canvas type="2d" id="shareCanvas" class="share-canvas" style="width: 375px; height: 600px;"></canvas>
</view>
